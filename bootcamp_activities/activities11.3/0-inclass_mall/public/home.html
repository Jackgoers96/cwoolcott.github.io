<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Meet me at the mall | Admin</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

</head>

<body>

    <div class="container">

        <div class="jumbotron">
            <img src="/images/yung.jpg">
            <h1 class="text-center">Jung Joc Mall &mdash; Admin Tool</h1>
            <hr>
            <h2 class="text-center">"Meet me at the Mall"<br>Add + Open/Close Stores</h2>
            <br>

            <div class="text-center">
                <a href="/addstore"><button class="btn btn-lg btn-primary"><span class="fa fa-list-alt"></span>
                        Add Store</button></a>
            </div>
            <br>

            <div class="card">
                <div class="card-header">
                    <h4>Current Stores and Status</h4>
                </div>
                <div class="card-body">
                    <ul id="storeList" class="list-group"></ul>
                </div>
            </div>

        </div>



    </div>
    +
    <script>
        function getStores() {
            $.ajax({ url: "/api/stores", method: "GET" }).then(function (storeData) {
                console.log(storeData);
                console.log("------------------------------------");
                var storeList = $("#storeList");
                storeList.empty();

                for (var i = 0; i < storeData.length; i++) {
                    // Then display the fields in the HTML
                    var listItem = $("<li class='list-group-item mt-4'>");

                    var buttonStatusClass;

                    if (storeData[i].status === 'open') {
                        buttonStatusClass = "btn-success";
                    }
                    else {
                        buttonStatusClass = "btn-danger";
                    }

                    var openCloseBtn = $("<button class='btn openCloseButton'>");
                    openCloseBtn.addClass(buttonStatusClass);

                    openCloseBtn.attr("data-store-id", storeData[i].storeID);
                    openCloseBtn.attr("data-status", storeData[i].status);
                    openCloseBtn.html(storeData[i].status);

                    var store = $("<div>");
                    store.append("<h3>" + storeData[i].storeName + "</h3>");
                    store.append("<h4><i>" + storeData[i].storeDescription + "</i></h4>");
                    store.append(openCloseBtn);
                    store.append("<hr>");

                    storeList.append(store);

                }


            });
        }

        $(document).on("click", ".openCloseButton", function () {

            var storeID = $(this).data("store-id");
            var status = $(this).data("status");

            var storeUpdate = {
                storeID: storeID,
                status: status
            };

            $.post("/api/storeupdate", storeUpdate,
                function (data) {
                    //data = true
                    console.log(data)

                    getStores();
                });

        });


        //Get Stores on Load of the Page
        getStores();




    </script>

</body>

</html>